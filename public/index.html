<!DOCTYPE html>
<html>
<head>
  <title>Mini Roblox V2</title>
  <style>
    body{margin:0;background:#222;color:#fff;font-family:Arial}
    #menu{position:fixed;inset:0;display:flex;gap:10px;flex-direction:column;align-items:center;justify-content:center;background:#111}
    canvas{display:none;background:#333}
    #hud{position:fixed;top:10px;left:10px}
  </style>
</head>
<body>

<div id="menu">
  <h1>Mini Roblox</h1>
  <input id="name" placeholder="Ä°smin">
  <input id="color" type="color">
  <select id="skin">
    <option value="square">Kare</option>
    <option value="circle">Daire</option>
  </select>
  <button onclick="start()">PLAY</button>
</div>

<div id="hud"></div>
<canvas id="c" width="800" height="600"></canvas>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket=io();
const c=document.getElementById("c"),ctx=c.getContext("2d");
let cam={x:0,y:0};
let me={x:100,y:100,name:"",color:"#f00",skin:"square"};
let players={}, it=null;

if(localStorage.name) name.value=localStorage.name;

function start(){
  me.name=name.value||"Player";
  me.color=color.value;
  me.skin=skin.value;
  localStorage.name=me.name;
  menu.style.display="none";
  c.style.display="block";
}

document.onkeydown=e=>{
  let s=6;
  if(e.key=="w")me.y-=s;
  if(e.key=="s")me.y+=s;
  if(e.key=="a")me.x-=s;
  if(e.key=="d")me.x+=s;
  socket.emit("update",me);
};

socket.on("state", d=>{
  players=d.players;
  it=d.it;
  hud.innerText = it ? "Ebe: "+players[it]?.name : "";
});

function drawPlayer(p){
  ctx.fillStyle=p.color;
  if(p.skin=="circle"){
    ctx.beginPath();ctx.arc(p.x-cam.x,p.y-cam.y,12,0,7);ctx.fill();
  }else{
    ctx.fillRect(p.x-cam.x,p.y-cam.y,24,24);
  }
  ctx.fillText(p.name,p.x-cam.x,p.y-cam.y-5);
}

function loop(){
  cam.x=me.x-400; cam.y=me.y-300;
  ctx.clearRect(0,0,800,600);
  for(let id in players) drawPlayer(players[id]);
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
